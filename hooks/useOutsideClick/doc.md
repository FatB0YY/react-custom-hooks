# useOutsideClick

Хук `useOutsideClick` предназначен для обнаружения кликов, которые происходят за пределами указанного DOM-элемента.

## Разбор работы хука:

- Хук использует вспомогательный хук useEvent для создания стабильной ссылки на функцию обратного вызова, чтобы избежать проблем, связанных с изменением ссылок на функции при каждом рендере.

- При помощи useEffect устанавливается слушатель события click на документ. Каждый раз, когда происходит клик, функция-обработчик проверяет:

  - Если ссылка на элемент (elementRef.current) существует.
  - Если клик произошёл вне указанного элемента (проверяется с помощью метода contains).

- Если оба условия выполняются, вызывается eventHandleOutsideClick.

- При размонтировании компонента или изменении зависимостей слушатель удаляется, что предотвращает утечки памяти.

## Особенности:

- Флаг `attached` позволяет динамически включать или отключать обработку кликов.
- Использование `useEvent` обеспечивает корректное поведение `callback (onOutsideClick)` даже при изменениях в компоненте, не создавая лишних подписок.

## Еще больше особенностей

- Почему вместо `addEventListener("click")`, было решено использовать `addEventListener("mousedown")` и `addEventListener("touchstart")`?

Так как событие `click` обрабатывается только после событий `mousedown` / `touchstart`, которые в свою очередь выполняются раньше событий `mouseup` / `touchend`:

то есть схема такая:

```
(`mousedown` / `touchstart`) -> (`mouseup` / `touchend`) -> `click`
```

Нюанс в том, что когда используется `click event`, у нас будет такой порядок действий:

1. Mousedown по кнопке
2. Mousedown на документе
3. Click по кнопке
4. Обновление компонента, состояния
5. useEffect + addEventListener
6. Click на документ
7. Outside Click

Это влечет за собой то, что у нас сразу закроется тултип.

Однако при `mouse down` евенте порядок такой:

1. Mousedown по кнопке
2. Mousedown на документе (нету ивент литсенера)
3. Click по кнопке
4. Обновление компонента, состояния
5. useEffect + addEventListener
6. Click на document
7. Ничего не происходит

Решение с `mouse down` как раз решает данную проблему.

Подробное объяснение: https://www.youtube.com/watch?v=ARtc9geJRUM
https://www.youtube.com/watch?v=UbQJWpwensk
